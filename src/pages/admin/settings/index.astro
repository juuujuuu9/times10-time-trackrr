---
import AdminLayout from '../../../layouts/AdminLayout.astro';
import { requireRole } from '../../../utils/session';

// Get current user
const user = await requireRole(Astro, 'admin', '/admin') as any;
---

<AdminLayout title="Settings" currentPage="settings">
  <div class="space-y-8">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-300 p-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">System Settings</h1>
          <p class="text-gray-600 mt-2">Configure your organization and system preferences</p>
        </div>
        <div class="flex items-center space-x-3">
          <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
          <span class="text-sm text-gray-600">System Online</span>
        </div>
      </div>
    </div>

    <!-- Settings Sections -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Organization Information -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-300 overflow-hidden">
        <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
          <div class="flex items-center">
            <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-3">
              <span class="text-gray-700 text-xl">üè¢</span>
            </div>
            <h3 class="text-xl font-semibold text-gray-900">Organization Information</h3>
          </div>
        </div>
        <div class="p-6">
          <form id="orgForm" class="space-y-6">
            <div>
              <label for="orgName" class="block text-sm font-semibold text-gray-700 mb-2">
                Organization Name
              </label>
              <input
                type="text"
                id="orgName"
                value="Times10 Time Tracker"
                class="w-[calc(100%-2rem)] px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200 bg-white text-gray-900"
                placeholder="Enter organization name"
              />
            </div>
            <div>
              <label for="orgEmail" class="block text-sm font-semibold text-gray-700 mb-2">
                Contact Email
              </label>
              <input
                type="email"
                id="orgEmail"
                value="admin@times10.com"
                class="w-[calc(100%-2rem)] px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200 bg-white text-gray-900"
                placeholder="Enter contact email"
              />
            </div>
            <div>
              <label for="orgWebsite" class="block text-sm font-semibold text-gray-700 mb-2">
                Website
              </label>
              <input
                type="url"
                id="orgWebsite"
                value="https://times10.com"
                class="w-[calc(100%-2rem)] px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200 bg-white text-gray-900"
                placeholder="Enter website URL"
              />
            </div>
            <div>
              <label for="orgLogo" class="block text-sm font-semibold text-gray-700 mb-2">
                Logo URL
              </label>
              <input
                type="url"
                id="orgLogo"
                value="https://times10.com/logo.png"
                class="w-[calc(100%-2rem)] px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200 bg-white text-gray-900"
                placeholder="Enter logo URL"
              />
            </div>
            <div class="flex justify-end pt-4">
              <button
                type="submit"
                class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
              >
                üíæ Save Organization Info
              </button>
            </div>
          </form>
              </div>
    </div>

    <!-- User Profile -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-300 overflow-hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-3">
            <span class="text-gray-700 text-xl">üë§</span>
          </div>
          <h3 class="text-xl font-semibold text-gray-900">Your Profile</h3>
        </div>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Full Name
              </label>
              <div class="px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg text-gray-900">
                {user?.name || 'Unknown'}
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Email Address
              </label>
              <div class="px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg text-gray-900">
                {user?.email || 'No email'}
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Role
              </label>
              <div class="px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg">
                <span class={`inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold ${
                  user?.role === 'admin' 
                    ? 'bg-black text-white' 
                    : user?.role === 'developer'
                    ? 'bg-red-600 text-white'
                    : 'bg-gray-100 text-gray-800'
                }`}>
                  {user?.role === 'admin' ? 'Admin' : user?.role === 'developer' ? 'Developer' : 'Team Member'}
                </span>
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Status
              </label>
              <div class="px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-green-100 text-green-800">
                  {user?.status ? user.status.charAt(0).toUpperCase() + user.status.slice(1) : 'Unknown'}
                </span>
              </div>
            </div>
          </div>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Account Actions
              </label>
              <div class="space-y-3">
                <button 
                  id="changePasswordBtn"
                  class="w-full px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors"
                >
                  üîê Change Password
                </button>
                <button 
                  id="updateEmailBtn"
                  class="w-full px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors"
                >
                  üìß Update Email
                </button>
                <button 
                  id="editProfileBtn"
                  class="w-full px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors"
                >
                  üë§ Edit Profile
                </button>
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Integrations
              </label>
              <div class="space-y-3">
                <a href="/admin/slack" class="w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors inline-flex items-center justify-center">
                  <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M6 15a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm6-8a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm6 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 2a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/>
                  </svg>
                  Manage Slack Integration
                </a>
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Session Information
              </label>
              <div class="px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg text-gray-900 text-sm">
                <div class="flex justify-between items-center">
                  <span>Last Login:</span>
                  <span class="text-gray-600">Just now</span>
                </div>
                <div class="flex justify-between items-center mt-2">
                  <span>Session ID:</span>
                  <span class="text-gray-600 font-mono text-xs">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- System Preferences -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-300 overflow-hidden">
        <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
          <div class="flex items-center">
            <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-3">
              <span class="text-gray-700 text-xl">‚öôÔ∏è</span>
            </div>
            <h3 class="text-xl font-semibold text-gray-900">System Preferences</h3>
          </div>
        </div>
        <div class="p-6">
          <form id="systemForm" class="space-y-6">
            <div>
              <label for="timezone" class="block text-sm font-semibold text-gray-700 mb-2">
                Default Timezone
              </label>
              <select
                id="timezone"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200 bg-white text-gray-900"
              >
                <option value="UTC">UTC</option>
                <option value="America/New_York" selected>Eastern Time (ET)</option>
                <option value="America/Chicago">Central Time (CT)</option>
                <option value="America/Denver">Mountain Time (MT)</option>
                <option value="America/Los_Angeles">Pacific Time (PT)</option>
                <option value="Europe/London">London (GMT)</option>
                <option value="Europe/Paris">Paris (CET)</option>
                <option value="Asia/Tokyo">Tokyo (JST)</option>
              </select>
            </div>
            <div>
              <label for="dateFormat" class="block text-sm font-semibold text-gray-700 mb-2">
                Date Format
              </label>
              <select
                id="dateFormat"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200 bg-white text-gray-900"
              >
                <option value="MM/DD/YYYY" selected>MM/DD/YYYY</option>
                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
              </select>
            </div>
            <div>
              <label for="timeFormat" class="block text-sm font-semibold text-gray-700 mb-2">
                Time Format
              </label>
              <select
                id="timeFormat"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200 bg-white text-gray-900"
              >
                <option value="12" selected>12-hour (AM/PM)</option>
                <option value="24">24-hour</option>
              </select>
            </div>
            <div>
              <label for="weekStart" class="block text-sm font-semibold text-gray-700 mb-2">
                Week Start Day
              </label>
              <select
                id="weekStart"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200 bg-white text-gray-900"
              >
                <option value="sunday" selected>Sunday</option>
                <option value="monday">Monday</option>
              </select>
            </div>
            <div class="flex justify-end pt-4">
              <button
                type="submit"
                class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
              >
                üíæ Save Preferences
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- User Roles & Permissions -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-300 overflow-hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-3">
            <span class="text-gray-700 text-xl">üë•</span>
          </div>
          <h3 class="text-xl font-semibold text-gray-900">User Roles & Permissions</h3>
        </div>
        <p class="text-sm text-gray-600 mt-1">Configure user roles and their permissions</p>
      </div>
      <div class="p-6">
        <div class="space-y-6">
          <!-- Admin Role -->
          <div class="border border-gray-200 rounded-xl p-6 bg-gray-50">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center">
                <div class="w-12 h-12 bg-gray-200 rounded-xl flex items-center justify-center mr-4">
                  <span class="text-gray-700 text-xl">üëë</span>
                </div>
                <div>
                  <h4 class="text-xl font-semibold text-gray-900">Admin</h4>
                  <p class="text-sm text-gray-600">Full system access including all financial data</p>
                </div>
              </div>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-black text-white">
                Default Role
              </span>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" checked disabled class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">Manage Users</span>
              </div>
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" checked disabled class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">Manage Projects</span>
              </div>
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" checked disabled class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">View Reports</span>
              </div>
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" checked disabled class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">System Settings</span>
              </div>
            </div>
          </div>

          <!-- Developer Role -->
          <div class="border border-gray-200 rounded-xl p-6 bg-gray-50">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center">
                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
                  <span class="text-blue-700 text-xl">üíª</span>
                </div>
                <div>
                  <h4 class="text-xl font-semibold text-gray-900">Developer</h4>
                  <p class="text-sm text-gray-600">Full access with financial data hidden</p>
                </div>
              </div>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800">
                Advanced Role
              </span>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" checked disabled class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">Manage Users</span>
              </div>
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" checked disabled class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">Manage Projects</span>
              </div>
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" checked disabled class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">View Reports</span>
              </div>
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" checked disabled class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">System Settings</span>
              </div>
            </div>
            <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
              <p class="text-sm text-yellow-800">
                <span class="font-medium">Note:</span> Financial data (dollar amounts, costs, pay rates) is hidden and appears as asterisks (***) for privacy.
              </p>
            </div>
          </div>

          <!-- User Role -->
          <div class="border border-gray-200 rounded-xl p-6 bg-gray-50">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center">
                <div class="w-12 h-12 bg-gray-200 rounded-xl flex items-center justify-center mr-4">
                  <span class="text-gray-700 text-xl">üë§</span>
                </div>
                <div>
                  <h4 class="text-xl font-semibold text-gray-900">User</h4>
                  <p class="text-sm text-gray-600">Standard user with limited access</p>
                </div>
              </div>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-gray-100 text-gray-700">
                Standard Role
              </span>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">View Projects</span>
              </div>
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" checked class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">Track Time</span>
              </div>
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">View Reports</span>
              </div>
              <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                <input type="checkbox" class="rounded border-gray-300 text-gray-600 focus:ring-gray-400 bg-white" />
                <span class="ml-3 text-sm font-medium text-gray-900">Manage Tasks</span>
              </div>
            </div>
          </div>

          <div class="flex justify-end pt-4">
            <button
              class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
            >
              üíæ Save Role Permissions
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Project Templates -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-300 overflow-hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-3">
            <span class="text-gray-700 text-xl">üìã</span>
          </div>
          <h3 class="text-xl font-semibold text-gray-900">Project Templates</h3>
        </div>
        <p class="text-sm text-gray-600 mt-1">Create reusable project and task structures</p>
      </div>
      <div class="p-6">
        <div class="space-y-4">
          <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl border border-gray-200">
            <div class="flex items-center">
              <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-4">
                <span class="text-gray-700 text-lg">üåê</span>
              </div>
              <div>
                <h4 class="text-lg font-semibold text-gray-900">Web Development Template</h4>
                <p class="text-sm text-gray-600">Standard tasks for web development projects</p>
              </div>
            </div>
            <div class="flex space-x-2">
              <button class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors">Edit</button>
              <button class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-medium rounded-lg transition-colors">Delete</button>
            </div>
          </div>
          <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl border border-gray-200">
            <div class="flex items-center">
              <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-4">
                <span class="text-gray-700 text-lg">üé®</span>
              </div>
              <div>
                <h4 class="text-lg font-semibold text-gray-900">Design Project Template</h4>
                <p class="text-sm text-gray-600">Common tasks for design projects</p>
              </div>
            </div>
            <div class="flex space-x-2">
              <button class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors">Edit</button>
              <button class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-medium rounded-lg transition-colors">Delete</button>
            </div>
          </div>
          <div class="flex justify-end pt-4">
            <button
              class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
            >
              ‚ûï Add Template
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- System Information -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-300 overflow-hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-3">
            <span class="text-gray-700 text-xl">‚ÑπÔ∏è</span>
          </div>
          <h3 class="text-xl font-semibold text-gray-900">System Information</h3>
        </div>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <span class="mr-2">üöÄ</span>
              Application
            </h4>
            <div class="space-y-3 text-sm">
              <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                <span class="font-medium text-gray-700">Version:</span>
                <span class="text-gray-900 font-semibold">1.0.0</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                <span class="font-medium text-gray-700">Environment:</span>
                <span class="text-gray-900 font-semibold">Production</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                <span class="font-medium text-gray-700">Database:</span>
                <span class="text-gray-900 font-semibold">PostgreSQL (Neon)</span>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <span class="mr-2">üñ•Ô∏è</span>
              Server
            </h4>
            <div class="space-y-3 text-sm">
              <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                <span class="font-medium text-gray-700">Platform:</span>
                <span class="text-gray-900 font-semibold">Astro + React</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                <span class="font-medium text-gray-700">Node.js:</span>
                <span class="text-gray-900 font-semibold">v18+</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                <span class="font-medium text-gray-700">Last Updated:</span>
                <span class="text-gray-900 font-semibold">{new Date().toLocaleDateString()}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Edit Modal -->
  <div id="profileEditModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-md w-full">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-900">Edit Profile</h3>
            <button id="closeProfileModal" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
        <form id="profileEditForm" class="p-6">
          <div class="space-y-4">
            <div>
              <label for="editName" class="block text-sm font-semibold text-gray-700 mb-2">
                Full Name
              </label>
              <input
                type="text"
                id="editName"
                value={user?.name || ''}
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200"
                placeholder="Enter your full name"
              />
            </div>
            <div>
              <label for="editEmail" class="block text-sm font-semibold text-gray-700 mb-2">
                Email Address
              </label>
              <input
                type="email"
                id="editEmail"
                value={user?.email || ''}
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200"
                placeholder="Enter your email"
              />
            </div>
          </div>
          <div class="flex justify-end space-x-3 mt-6">
            <button
              type="button"
              id="cancelProfileEdit"
              class="px-4 py-2 text-gray-600 hover:text-gray-800 font-medium"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors"
            >
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Password Change Modal -->
  <div id="passwordChangeModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-md w-full">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-900">Change Password</h3>
            <button id="closePasswordModal" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
        <form id="passwordChangeForm" class="p-6">
          <div class="space-y-4">
            <div>
              <label for="currentPassword" class="block text-sm font-semibold text-gray-700 mb-2">
                Current Password
              </label>
              <input
                type="password"
                id="currentPassword"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200"
                placeholder="Enter current password"
                required
              />
            </div>
            <div>
              <label for="newPassword" class="block text-sm font-semibold text-gray-700 mb-2">
                New Password
              </label>
              <input
                type="password"
                id="newPassword"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200"
                placeholder="Enter new password"
                minlength="8"
                required
              />
            </div>
            <div>
              <label for="confirmPassword" class="block text-sm font-semibold text-gray-700 mb-2">
                Confirm New Password
              </label>
              <input
                type="password"
                id="confirmPassword"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200"
                placeholder="Confirm new password"
                minlength="8"
                required
              />
            </div>
          </div>
          <div class="flex justify-end space-x-3 mt-6">
            <button
              type="button"
              id="cancelPasswordChange"
              class="px-4 py-2 text-gray-600 hover:text-gray-800 font-medium"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors"
            >
              Change Password
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Email Update Modal -->
  <div id="emailUpdateModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-md w-full">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-900">Update Email</h3>
            <button id="closeEmailModal" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
        <form id="emailUpdateForm" class="p-6">
          <div class="space-y-4">
            <div>
              <label for="newEmail" class="block text-sm font-semibold text-gray-700 mb-2">
                New Email Address
              </label>
              <input
                type="email"
                id="newEmail"
                value={user?.email || ''}
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200"
                placeholder="Enter new email address"
                required
              />
            </div>
            <div>
              <label for="emailPassword" class="block text-sm font-semibold text-gray-700 mb-2">
                Current Password
              </label>
              <input
                type="password"
                id="emailPassword"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all duration-200"
                placeholder="Enter current password to confirm"
                required
              />
            </div>
          </div>
          <div class="flex justify-end space-x-3 mt-6">
            <button
              type="button"
              id="cancelEmailUpdate"
              class="px-4 py-2 text-gray-600 hover:text-gray-800 font-medium"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors"
            >
              Update Email
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Settings JavaScript
    const orgForm = document.getElementById('orgForm');
    const systemForm = document.getElementById('systemForm');

    if (orgForm) {
      orgForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const orgName = (document.getElementById('orgName') as HTMLInputElement)?.value;
        const orgEmail = (document.getElementById('orgEmail') as HTMLInputElement)?.value;
        const orgWebsite = (document.getElementById('orgWebsite') as HTMLInputElement)?.value;
        const orgLogo = (document.getElementById('orgLogo') as HTMLInputElement)?.value;
        
        try {
          const response = await fetch('/api/admin/settings/organization', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              name: orgName,
              email: orgEmail,
              website: orgWebsite,
              logo: orgLogo
            }),
          });
          
          if (response.ok) {
            alert('Organization settings saved successfully');
          } else {
            alert('Error saving organization settings');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Error saving organization settings');
        }
      });
    }

    if (systemForm) {
      systemForm.addEventListener('submit', (e) => {
        e.preventDefault();
        alert('System preferences functionality coming soon!');
      });
    }

    // Profile Management JavaScript
    const profileEditBtn = document.getElementById('editProfileBtn');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const updateEmailBtn = document.getElementById('updateEmailBtn');

    // Modal elements
    const profileEditModal = document.getElementById('profileEditModal');
    const passwordChangeModal = document.getElementById('passwordChangeModal');
    const emailUpdateModal = document.getElementById('emailUpdateModal');

    // Profile Edit Modal
    if (profileEditBtn && profileEditModal) {
      profileEditBtn.addEventListener('click', () => {
        profileEditModal.classList.remove('hidden');
      });

      document.getElementById('closeProfileModal')?.addEventListener('click', () => {
        profileEditModal.classList.add('hidden');
      });

      document.getElementById('cancelProfileEdit')?.addEventListener('click', () => {
        profileEditModal.classList.add('hidden');
      });

      document.getElementById('profileEditForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = (document.getElementById('editName') as HTMLInputElement)?.value;
        const email = (document.getElementById('editEmail') as HTMLInputElement)?.value;

        try {
          const response = await fetch('/api/profile/update', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email }),
          });

          const result = await response.json();
          
          if (result.success) {
            alert('Profile updated successfully');
            profileEditModal.classList.add('hidden');
            // Refresh the page to show updated information
            window.location.reload();
          } else {
            alert(result.error || 'Error updating profile');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Error updating profile');
        }
      });
    }

    // Password Change Modal
    if (changePasswordBtn && passwordChangeModal) {
      changePasswordBtn.addEventListener('click', () => {
        passwordChangeModal.classList.remove('hidden');
      });

      document.getElementById('closePasswordModal')?.addEventListener('click', () => {
        passwordChangeModal.classList.add('hidden');
      });

      document.getElementById('cancelPasswordChange')?.addEventListener('click', () => {
        passwordChangeModal.classList.add('hidden');
      });

      document.getElementById('passwordChangeForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const currentPassword = (document.getElementById('currentPassword') as HTMLInputElement)?.value;
        const newPassword = (document.getElementById('newPassword') as HTMLInputElement)?.value;
        const confirmPassword = (document.getElementById('confirmPassword') as HTMLInputElement)?.value;

        if (newPassword !== confirmPassword) {
          alert('New passwords do not match');
          return;
        }

        try {
          const response = await fetch('/api/profile/update', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              currentPassword, 
              newPassword 
            }),
          });

          const result = await response.json();
          
          if (result.success) {
            alert('Password changed successfully');
            passwordChangeModal.classList.add('hidden');
            // Clear form
            (document.getElementById('passwordChangeForm') as HTMLFormElement)?.reset();
          } else {
            alert(result.error || 'Error changing password');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Error changing password');
        }
      });
    }

    // Email Update Modal
    if (updateEmailBtn && emailUpdateModal) {
      updateEmailBtn.addEventListener('click', () => {
        emailUpdateModal.classList.remove('hidden');
      });

      document.getElementById('closeEmailModal')?.addEventListener('click', () => {
        emailUpdateModal.classList.add('hidden');
      });

      document.getElementById('cancelEmailUpdate')?.addEventListener('click', () => {
        emailUpdateModal.classList.add('hidden');
      });

      document.getElementById('emailUpdateForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = (document.getElementById('newEmail') as HTMLInputElement)?.value;
        const password = (document.getElementById('emailPassword') as HTMLInputElement)?.value;

        try {
          const response = await fetch('/api/profile/update', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              email,
              currentPassword: password
            }),
          });

          const result = await response.json();
          
          if (result.success) {
            alert('Email updated successfully');
            emailUpdateModal.classList.add('hidden');
            // Refresh the page to show updated information
            window.location.reload();
          } else {
            alert(result.error || 'Error updating email');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Error updating email');
        }
      });
    }

    // Close modals when clicking outside
    [profileEditModal, passwordChangeModal, emailUpdateModal].forEach(modal => {
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.add('hidden');
          }
        });
      }
    });
  </script>
</AdminLayout> 